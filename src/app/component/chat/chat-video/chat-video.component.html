<ng-container *mobxAutorun>
  @if (!store.video.enabled) {
    <div class="submit-button" (click)="call()" tabindex="0">
      <span i18n-title title="Start a Call" i18n>ğŸ“ï¸</span> <label i18n>call</label>
    </div>
  } @else {
    <div class="submit-button" (click)="hangup()" tabindex="0">
      <span i18n-title title="End a Call" i18n>ğŸ‘‹ï¸</span> <label i18n>hangup</label>
    </div>

    <div class="call-layout" [class.two-person]="isTwoPersonCall">
      <!-- Featured video (callee for 2-person, active speaker for group) -->
      @if (featuredStream) {
        <div class="featured-section">
          <div class="stream-label glass">
            @if (authorExt$(featuredStream.tag) | async; as x) {
              <a class="user tag"
                 [routerLink]="['/tag', x.tag + x.origin]"
                 [appTitle]="x">{{ x.name }}</a>
            }
          </div>
          @for (s of featuredStream.streams; track s.stream.id) {
            <video [srcObject]="s.stream"
                   [class.loading]="!s.live"
                   class="featured-video" autoplay playsinline></video>
          } @empty {
            <div class="loading video-placeholder featured-video"></div>
          }
        </div>
      }
      <div class="video-grid">
        @for (u of gridStreams; track u.tag) {
          <div class="grid-tile">
            <div class="stream-label glass">
              @if (authorExt$(u.tag) | async; as x) {
                <a class="user tag"
                   [routerLink]="['/tag', x.tag + x.origin]"
                   [appTitle]="x">{{ x.name }}</a>
              }
            </div>
            @for (s of u.streams; track s.stream.id) {
              <video
                [srcObject]="s.stream"
                [class.loading]="!s.live"
                autoplay
                playsinline
                tabindex="0"
                (click)="speaker = u.tag"
                (keydown.enter)="speaker = u.tag"
                (keydown.space)="speaker = u.tag"></video>
            }
          </div>
        }
        @if (store.video.stream) {
          <div class="grid-tile">
            <div class="stream-label glass">
              <a class="user tag"
                 [routerLink]="['/tag', store.account.tag]"
                 [appTitle]="store.account.ext" i18n>â­•ï¸ Me</a>
            </div>
            <video [srcObject]="store.video.stream" class="mirror-video" autoplay playsinline [muted]="true"></video>
          </div>
        }
        @for (tag of hungup; track tag) {
          <div class="grid-tile">
            <div class="stream-label glass">
              @if (authorExt$(tag) | async; as x) {
                <a class="user tag"
                   [routerLink]="['/tag', x.tag + x.origin]"
                   [appTitle]="x">{{ x.name }}</a>
              }
            </div>
            <div class="hungup video-placeholder" i18n-title title="Hung up" i18n>ğŸ‘‹ï¸</div>
          </div>
        }
      </div>

      <!-- Passive Viewers Section -->
      @if (viewers.length) {
        <div class="viewers-section">
          <h4 i18n>Viewers</h4>
          <div class="viewer-list">
            @for (v of viewers; track v) {
              <div class="viewer-tag">
                @if (authorExt$(v) | async; as x) {
                  <a class="user tag"
                     [routerLink]="['/tag', x.tag + x.origin]"
                     [appTitle]="x">{{ x.name }}</a>
                }
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</ng-container>
