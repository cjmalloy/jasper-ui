<ng-container *mobxAutorun>
  <div class="row dont-hide">
    <div class="toggle dont-hide"
         *ngIf="showToggle"
         (click)="expanded = !expanded">â˜°</div>
    <div *ngIf="!!type" class="wide dont-hide">
      <app-search class="dont-hide"></app-search>
      <ng-container *ngIf="expanded && type === 'ref'">
        <br>
        <app-filter></app-filter>
      </ng-container>
      <ng-container *ngIf="expanded && showSort">
        <br>
        <app-sort [type]="type"></app-sort>
      </ng-container>
    </div>
  </div>
  <app-query [query]="tag" class="breadcrumbs"></app-query>
  <app-debug *ngIf="expanded"></app-debug>
  <app-bulk *ngIf="expanded && type" [type]="type"></app-bulk>
  <ng-container *ngIf="store.account.poster">
    <div class="submit-button" routerLink="/submit" [queryParams]="{ tag: localTag }">
      ğŸ“ï¸ &nbsp; Submit
    </div>
  </ng-container>
  <ng-container *ngIf="!ext && (store.account.editor || writeAccess)">
    <div class="submit-button" routerLink="/create/ext" [queryParams]="{ tag: writeAccess ? localTag : '' }">
      ğŸ–Œï¸ &nbsp; Extend Tag
    </div>
  </ng-container>
  <ng-container *ngIf="ext && writeAccess">
    <div class="submit-button" [routerLink]="['/tag', localTag, 'edit']">
      ğŸ–Œï¸ &nbsp; Extend Tag
    </div>
  </ng-container>
  <ng-container *ngIf="config.scim && store.account.mod">
    <div class="submit-button" routerLink="/create/profile" [queryParams]="{ tag: localTag }">
      ğŸ‘¤ï¸ &nbsp; Create Profile
    </div>
  </ng-container>
  <ng-container *ngIf="store.account.mod">
    <div class="submit-button" routerLink="/create/user" [queryParams]="{ tag: localTag }">
      ğŸ—ï¸ï¸ &nbsp; User Permissions
    </div>
  </ng-container>
  <ng-container *ngIf="admin.status.plugins.inbox">
    <ng-container *ngIf="user && store.account.tag !== tag">
      <div class="submit-button" routerLink="/submit/dm" [queryParams]="{ to: tag }">
        âœ‰ï¸ &nbsp; Direct Message {{ tag }}
      </div>
    </ng-container>
    <ng-container *ngIf="store.account.poster && !user && modmail">
      <div class="submit-button" routerLink="/submit/dm" [queryParams]="{ to: tag }">
        âœ‰ï¸ &nbsp; Mod Mail {{ tag }}
      </div>
    </ng-container>
  </ng-container>
  <ng-container *ngIf="store.account.signedIn && store.account.tag === tag">
    <div class="submit-button" routerLink="/settings/password">
      ğŸ”‘ï¸ï¸ &nbsp; Change Password
    </div>
  </ng-container>

  <div class="tag-header" *ngIf="home">
    <h3><a [routerLink]="['/home']">Home</a></h3>

    <ng-container *ngIf="homeWriteAccess">
      <a *ngIf="admin.status.templates.home"
         class="sidebar-link edit"
         [routerLink]="['/tag', '+home']">
        edit
      </a>
    </ng-container>
  </div>
  <div class="tag-header" *ngIf="!home && ext?.name || tag">
    <h3>{{ ext?.name || tag }}</h3>
    <ng-container *ngIf="store.account.signedIn && tag && admin.status.templates.user">
      <button *ngIf="inSubs; else notInSubs"
              class="subscribe"
              (click)="unsubscribe()">&ndash; unsubscribe</button>
      <ng-template #notInSubs>
        <button (click)="subscribe()"
                title="Add to home screen"
                class="subscribe">+ subscribe</button>
      </ng-template>
      <button *ngIf="inBookmarks; else notBookmarked"
              class="bookmark"
              (click)="removeBookmark()">&ndash; bookmark</button>
      <ng-template #notBookmarked>
        <button (click)="bookmark()"
                title="Add to top bar"
                class="bookmark">+ bookmark</button>
      </ng-template>
    </ng-container>
  </div>

  <ng-container *ngIf="ui && ext">
    <div class="ui"
         [appTemplateUi]="ui"
         [ext]="ext"></div>
  </ng-container>

  <ng-container *ngIf="queue">
    <div class="ext-text" *ngIf="ext?.config?.bounty">
      <b>Bounty:</b> {{ ext?.config?.bounty }}
    </div>
    <div class="ext-text" *ngIf="ext?.config?.maxAge">
      <b>Max Age:</b> {{ ext?.config?.maxAge }}
    </div>
    <div class="ext-text" *ngIf="ext?.config?.approvers?.length">
      <b>Approvers:</b>
      <br>
      <ng-container *ngFor="let a of ext!.config!.approvers!">
        <a class="tag" [routerLink]="['/tag', a]">
          {{ a }}
        </a>
        <br>
      </ng-container>
    </div>
    <div *ngIf="isApprover">
      <a class="sidebar-link"
         [routerLink]="['/tag', prefix('plugin/invoice/', ext!.tag)]">invoices</a>
    </div>
  </ng-container>

  <ng-container *ngIf="user || home">
    <div class="ext-text" *ngIf="ext?.config?.bookmarks?.length">
      My Bookmarks:
      <br>
      <ng-container *ngFor="let book of ext!.config!.bookmarks!">
        <a class="tag" [routerLink]="['/tag', book]">
          {{ book }}
        </a>
        <br>
      </ng-container>
      <br *ngIf="ext?.config?.subscriptions?.length">
    </div>
    <div class="ext-text" *ngIf="ext?.config?.subscriptions?.length">
      Subscribed to:
      <br>
      <ng-container *ngFor="let sub of ext!.config!.subscriptions!">
        <a class="tag" [routerLink]="['/tag', sub]">
          {{ sub }}
        </a>
        <br>
      </ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="root">
    <app-md *ngIf="ext?.config?.sidebar"
            [origin]="ext?.origin"
            [text]="ext!.config!.sidebar"></app-md>
  </ng-container>
</ng-container>
