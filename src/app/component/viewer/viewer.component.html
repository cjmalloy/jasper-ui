@if (ref || tags) {
  @if (repost) {
    <app-ref class="expand"
             [fetchRepost]="false"
             [showToggle]="true"
             [expandInline]="true"
             [ref]="repost"></app-ref>
  }
  @if (playlist) {
    <app-playlist [ref]="ref"></app-playlist>
  }
  @if (page) {
    <app-lens [page]="page"
              [pageControls]="false"
              [tag]="lensQuery"
              [ext]="ext"
              [size]="lensSize"
              [cols]="lensCols"
              [sort]="lensSort"
              [filter]="lensFilter"
              [search]="lensSearch"></app-lens>
  }
  @if (this.embedIframe) {
    <div class="embed-container"
         [class.loading]="!embedReady"
         [class.twitter]="twitter"
         [appResizeHandle]="resizable"
         [child]="iframe">
      <iframe #iframe
              class="embed-expand"
              [class.ready]="embedReady"
              src="about:blank"
              frameborder="0"
              scrolling="yes"
              allow="fullscreen; accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"></iframe>
    </div>
  }
  @if (imageUrl) {
    <div class="image-expand"
         [appImage]="imageUrl"
         [ref]="ref"
         [defaultWidth]="ref?.plugins?.['plugin/image']?.width"
         [defaultHeight]="ref?.plugins?.['plugin/image']?.height"
         [grid]="disableResize"
         [appResize]="!disableResize"></div>
  }
  @if (videoUrl) {
    <video #video
           class="video-expand"
           [autoplay]="autoplay"
           controls
           [appResize]="!disableResize">
      <source [src]="videoUrl">
    </video>
  }
  @if (audioUrl) {
    <audio class="audio-expand"
           [autoplay]="autoplay"
           controls>
      <source [src]="audioUrl">
    </audio>
  }
  @if (qrUrl) {
    <app-qr class="qr-expand"
            [url]="qrUrl"
            [appResize]="!disableResize"></app-qr>
  }
  @if (todo) {
    <app-todo [ref]="ref"
              [text]="text"
              [tags]="tags"
              (comment)="comment.emit($event)"
              (copied)="copied.emit($event)"></app-todo>
  }
  @if (backgammon) {
    <app-backgammon [ref]="ref"
                    [text]="text"
                    (comment)="comment.emit($event)"
                    (copied)="copied.emit($event)"></app-backgammon>
  }
  @if (chess) {
    <app-chess [white]="chessWhite"
               [ref]="ref"
               [text]="text"
               (comment)="comment.emit($event)"
               (copied)="copied.emit($event)"></app-chess>
  }
}
@if (code) {
  <app-md [origin]="currentOrigin"
          [text]="currentCode"></app-md>
} @else if (currentText) {
  <app-md [class.expand]="expand"
          [origin]="currentOrigin"
          [text]="currentText"
          [plugins]="currentTags"></app-md>
}
@if (pdfUrl) {
  <div class="embed-container"
       [appResizeHandle]="!disableResize"
       [child]="pdfIframe">
    <iframe #pdfIframe
            class="embed-expand"
            src="about:blank"
            frameborder="0"
            scrolling="yes"
            allow="fullscreen accelerometer autoplay clipboard-write encrypted-media gyroscope picture-in-picture web-share"
            referrerpolicy="strict-origin-when-cross-origin"></iframe>
  </div>
}
@for (ui of uis; track ui.tag) {
  <app-md [class]="uiCss(ui.tag)"
          [disableSanitizer]="true"
          [origin]="currentOrigin"
          [text]="uiMarkdown(ui.tag)"></app-md>
}
@if (mod) {
  <app-mod [mod]="mod"
           [class.expand]="expand"></app-mod>
}
