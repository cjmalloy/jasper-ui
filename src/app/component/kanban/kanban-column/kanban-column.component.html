@if (page) {
  @for (ref of page.content; track ref.origin + '@' + ref.url) {
    <app-kanban-card cdkDrag
                     [hideSwimLanes]="hideSwimLanes"
                     [cdkDragData]="ref"
                     [cdkDragStartDelay]="pressToUnlock ? 251 : 0"
                     [pressToUnlock]="pressToUnlock"
                     [ref]="ref"
                     [ext]="ext"
                     (copied)="copy($event)"></app-kanban-card>
  }
  @for (text of adding; track text) {
    <app-kanban-card [ref]="{ url: '', title: text }"
                     [ext]="ext"></app-kanban-card>
  }
  @for (upload of uploads; track upload.id) {
    <div class="upload-card">
      <div class="upload-content">
        <div class="upload-filename">{{ upload.name }}</div>
        @if (upload.error) {
          <div class="upload-error">{{ upload.error }}</div>
        } @else if (upload.completed) {
          <div class="upload-complete">✅️ Complete</div>
        } @else {
          <progress class="upload-progress-bar" max="100" [value]="upload.progress"></progress>
        }
      </div>
      @if (!upload.completed && !upload.error) {
        <button type="button"
                class="upload-cancel"
                (click)="cancelUpload(upload)"
                i18n-title title="Cancel upload"
                i18n>&ndash;</button>
      }
    </div>
  }
  @for (failedItem of failed; track failedItem.text) {
    <div class="failed-item">
      <div class="failed-content">
        <div class="failed-text">{{ failedItem.text }}</div>
        <div class="failed-error">{{ failedItem.error }}</div>
      </div>
      <div class="failed-actions">
        <button type="button"
                class="retry-btn"
                (click)="retry(failedItem)"
                i18n-title title="Retry creating this item"
                i18n>↻</button>
        <button type="button"
                class="dismiss-btn"
                (click)="dismissFailed(failedItem)"
                i18n-title title="Dismiss this failed item"
                i18n>&ndash;</button>
      </div>
    </div>
  }
} @else {
  <app-loading></app-loading>
}
<div class="spacer"></div>
@if (hasMore) {
  <a class="fake-link no-select load-more"
     (click)="loadMore()" i18n>load more @if (more) {<span class="more">({{ more }})</span>}</a>
}
<input #inputField
       type="text"
       enterkeyhint="send"
       i18n-placeholder
       placeholder="Add..."
       [value]="addText"
       (input)="addText = $any($event.target).value"
       (paste)="handlePaste($event)"
       [class.dropping]="dropping"
       (dragenter)="dropping = true"
       (dragleave)="dragLeave(inputField, $any($event.target))"
       (drop)="handleDrop($event)"
       (dragover)="$event.preventDefault()"
       [style.display]="addText ? 'block' : 'none'"
       (keydown)="$event.key === 'Enter' && add() || true"
       (blur)="add()">
