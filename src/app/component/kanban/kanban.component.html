<app-loading *ngIf="!error && !ext else loaded"></app-loading>
<ng-template #loaded>
  <div *ngIf="ext else error"
       class="kanban"
       cdkDropListGroup
       cdkScrollable
       [class.single-column]="(columns.length || 0) + (showNoColumn ? 1 : 0) === 1"
       [style.grid-template-columns]="(swimLanes ? 'auto ' : '') + (showNoColumn ? '1fr ' : '') + (columns.length ? 'repeat(' + columns.length + ', 1fr)' : '')">
    <div class="kanban-header"
         style="max-width: 90vw"
         cdkDropList
         [cdkDropListData]="{col: '-'+ext.tag}"
         (cdkDropListDropped)="drop($any($event))"
         [style.grid-column]="'1 / ' + (1 + (swimLanes ? 1 : 0) + (showNoColumn ? 1 : 0) + columns.length)">
      <div class="kanban-options">
        <h2>{{ ext.name || ext.tag }}</h2>
        <div>
          <div *ngIf="kanbanConfig.swimLanes?.length"
               class="disable-swim-lanes">
            <input id="disable-swim-lanes"
                   type="checkbox"
                   [(ngModel)]="disableSwimLanes">
            <label for="disable-swim-lanes" i18n>Hide Swim Lanes</label>
          </div>
          <app-page-controls></app-page-controls>
        </div>
      </div>
      <div class="kanban-remove">üóëÔ∏è</div>
    </div>
    <div *ngIf="swimLanes"><!-- corner spacer --></div>
    <a *ngIf="showNoColumn"
       class="column-title tag"
       (click)="bookmarks.toggleFilter(noCols)"
       title="No matching column tag">{{ kanbanConfig.columnBacklogTitle || 'Backlog' }}</a>
    <a *ngFor="let col of columns"
       class="column-title tag"
       (click)="bookmarks.toggleFilter(col)"
       [title]="col">{{ (exts.getCachedExt(col, ext.origin || '') | async)?.name || col }}</a>
    <ng-container *ngIf="swimLanes else noSwimLanes">
      <ng-container *ngFor="let sl of swimLanes">
        <a class="swim-lane-title tag"
           (click)="bookmarks.toggleFilter(sl)"
           [title]="sl">{{ (exts.getCachedExt(sl, ext.origin || '') | async)?.name || sl }}</a>
        <app-kanban-column *ngIf="showNoColumn"
                           cdkDropList
                           cdkScrollable
                           [hideSwimLanes]="disableSwimLanes"
                           [cdkDropListData]="{sl}"
                           (cdkDropListDropped)="drop($any($event))"
                           [updates]="updates"
                           [query]="getQuery({sl})"
                           [addTags]="addingTags({sl})"></app-kanban-column>
        <app-kanban-column *ngFor="let col of columns"
                           cdkDropList
                           cdkScrollable
                           [hideSwimLanes]="disableSwimLanes"
                           [cdkDropListData]="{col, sl}"
                           (cdkDropListDropped)="drop($any($event))"
                           [updates]="updates"
                           [query]="getQuery({col, sl})"
                           [addTags]="addingTags({col, sl})"></app-kanban-column>
      </ng-container>
      <ng-container *ngIf="showNoSwimLane">
        <a class="swim-lane-title tag"
           (click)="bookmarks.toggleFilter(noSl)"
           title="No matching swim lane">{{ kanbanConfig.swimLaneBacklogTitle || 'Backlog' }}</a>
        <app-kanban-column *ngIf="showNoColumn"
                           cdkDropList
                           cdkScrollable
                           [hideSwimLanes]="disableSwimLanes"
                           [cdkDropListData]="{}"
                           (cdkDropListDropped)="drop($any($event))"
                           [updates]="updates"
                           [query]="getQuery({})"
                           [addTags]="addingTags({})"></app-kanban-column>
        <app-kanban-column *ngFor="let col of columns"
                           cdkDropList
                           cdkScrollable
                           [hideSwimLanes]="disableSwimLanes"
                           [cdkDropListData]="{col}"
                           (cdkDropListDropped)="drop($any($event))"
                           [updates]="updates"
                           [query]="getQuery({col})"
                           [addTags]="addingTags({col})"></app-kanban-column>
      </ng-container>
    </ng-container>
    <ng-template #noSwimLanes>
      <app-kanban-column *ngIf="showNoColumn"
                         cdkDropList
                         cdkScrollable
                         [hideSwimLanes]="disableSwimLanes"
                         [cdkDropListData]="{}"
                         (cdkDropListDropped)="drop($any($event))"
                         [updates]="updates"
                         [query]="getQuery({})"
                         [addTags]="addingTags({})"></app-kanban-column>
      <app-kanban-column *ngFor="let col of columns"
                         cdkDropList
                         cdkScrollable
                         [hideSwimLanes]="disableSwimLanes"
                         [cdkDropListData]="{col}"
                         (cdkDropListDropped)="drop($any($event))"
                         [updates]="updates"
                         [query]="getQuery({col})"
                         [addTags]="addingTags({col})"></app-kanban-column>
    </ng-template>
  </div>
  <ng-template #error>
    <div class="error-404" i18n>Not Found</div>
  </ng-template>
</ng-template>
<app-page-controls></app-page-controls>
