<ng-container *mobxAutorun>
  <div #tabs class="tabs">
    <h5 class="fake-link" routerLink=".." [queryParams]="{}">{{ store.view.name }}</h5>
    <ng-container *ngIf="store.view.extTemplate else multipleExt">
      <a routerLink="./"
         [class.current-tab]="store.view.noView"
         [queryParams]="{view: null}"
         queryParamsHandling="merge" i18n>{{ store.view.extTemplate.config?.view || store.view.extTemplate.tag }}</a>
      <a routerLink="./"
         [class.current-tab]="store.view.list"
         [queryParams]="{view: 'list'}"
         queryParamsHandling="merge" i18n>list</a>
    </ng-container>
    <ng-template #multipleExt>
      <ng-container *ngIf="store.view.activeExts.length else noExt">
        <a *ngFor="let x of store.view.activeExts; let i = index"
           routerLink="./"
           [class.current-tab]="store.view.viewTag === x.tag"
           [queryParams]="{view: i === 0 ? null : x.tag}"
           queryParamsHandling="merge" i18n>{{ x.name || x.tag }}</a>
        <a routerLink="./"
           [class.current-tab]="store.view.list"
           [queryParams]="{view: 'list'}"
           queryParamsHandling="merge" i18n>list</a>
      </ng-container>
    </ng-template>
    <ng-template #noExt>
      <a routerLink="./"
         [class.current-tab]="store.view.noView"
         [queryParams]="{view: null}"
         queryParamsHandling="merge" i18n>list</a>
    </ng-template>
    <ng-container *ngIf="admin.status.templates.graph">
      <a routerLink="./"
         [class.current-tab]="store.view.graph"
         [queryParams]="{view: 'graph'}"
         queryParamsHandling="merge" i18n>graph</a>
    </ng-container>
    <app-mobile-tab-select [tabs]="tabs"></app-mobile-tab-select>
    <app-settings></app-settings>
  </div>
  <app-sidebar [floating]="floatingSidebar"
               [ext]="store.view.ext"
               [tag]="store.view.tag"></app-sidebar>
  <div *ngIf="query.error?.status === 403 else accessGranted" class="error-403" i18n>Access Denied</div>
  <ng-template #accessGranted>
    <!-- TODO: allow paging with graph -->
    <app-ref-list *ngIf="store.view.showList else tmpl"
                  [page]="query.page"
                  [pinned]="store.view.pinned"
                  [tag]="store.view.tag"
                  [graph]="store.view.graph"
                  [showAlarm]="!store.view.alarm"
                  [showVotes]="store.view.isVoteSorted"></app-ref-list>
    <ng-template #tmpl>
      <div class="error-404" *ngIf="!loading && !store.view.viewExt">
        Not Found
      </div>
      <app-ref-list *ngIf="store.view.isTemplate('plugin')"
                    [class]="cssClass(store.view.viewTag)"
                    [page]="query.page"
                    [pinned]="store.view.pinned"
                    [expanded]="store.view.viewExt?.config?.defaultExpanded"
                    [editable]="store.view.viewExt?.config?.editable"
                    [resizeable]="store.view.viewExt?.config?.resizeable"
                    [tag]="store.view.viewTag"
                    [plugins]="[store.view.viewTag]"
                    [showAlarm]="!store.view.alarm"
                    [showVotes]="store.view.isVoteSorted"></app-ref-list>
      <app-folder *ngIf="store.view.isTemplate('folder')"
                  [tag]="store.view.viewTag"
                  [ext]="store.view.viewExt!"
                  [page]="query.page"></app-folder>
      <app-kanban *ngIf="store.view.isTemplate('kanban')"
                  [query]="store.view.tag"
                  [ext]="store.view.viewExt"></app-kanban>
      <app-chat *ngIf="store.view.isTemplate('chat')"
                [query]="store.view.viewTag!"></app-chat>
      <app-blog *ngIf="store.view.isTemplate('blog')"
                [tag]="store.view.viewTag!"
                [page]="query.page"
                [pinned]="store.view.pinned"></app-blog>
    </ng-template>
  </ng-template>

</ng-container>
