<ng-container *mobxAutorun>
  <div #tabs class="tabs">
    <h5 class="fake-link" routerLink=".." [queryParams]="{}">{{ store.view.name }}</h5>
    <ng-container *ngFor="let t of templates">
      <ng-container *ngIf="store.view.isTemplate(t.tag)">
        <a routerLink="./"
           [class.current-tab]="store.view.noView"
           [queryParams]="{view: null}"
           queryParamsHandling="merge" i18n>{{ t.config?.view || t.tag }}</a>
      </ng-container>
    </ng-container>
    <a routerLink="./"
       [class.current-tab]="isTemplate ? store.view.list : store.view.noView"
       [queryParams]="{view: isTemplate ? 'list' : null}"
       queryParamsHandling="merge" i18n>list</a>
    <ng-container *ngIf="admin.status.plugins.graph">
      <a routerLink="./"
         [class.current-tab]="store.view.graph"
         [queryParams]="{view: 'graph'}"
         queryParamsHandling="merge" i18n>graph</a>
    </ng-container>
    <app-mobile-tab-select [tabs]="tabs"></app-mobile-tab-select>
    <app-settings></app-settings>
  </div>
  <app-sidebar class="aside"
               *ngIf="!store.view.graph"
               [tag]="store.view.tag!"
               [ext]="store.view.ext"></app-sidebar>
  <div *ngIf="query.error?.status === 403 else accessGranted" class="error-403" i18n>Access Denied</div>
  <ng-template #accessGranted>
    <!-- TODO: allow paging with graph -->
    <app-ref-list *ngIf="(!isTemplate || store.view.list || store.view.query) else tmpl"
                  [page]="query.page"
                  [pinned]="store.view.pinned"
                  [tag]="store.view.tag"
                  [graph]="store.view.graph"
                  [showVotes]="store.view.isVoteSorted"></app-ref-list>
    <ng-template #tmpl>
      <app-folder *ngIf="store.view.isTemplate('folder')"
                  [tag]="store.view.tag!"
                  [ext]="store.view.ext!"
                  [page]="query.page"></app-folder>
      <app-kanban *ngIf="store.view.isTemplate('kanban')"
                  [tag]="store.view.tag!"></app-kanban>
      <app-chat *ngIf="store.view.isTemplate('chat')"
                [query]="store.view.tag!"
                [addTags]="['public', 'internal', store.view.localTag]"></app-chat>
      <app-blog *ngIf="store.view.isTemplate('blog')"
                [tag]="store.view.tag!"
                [page]="query.page"
                [pinned]="store.view.pinned"></app-blog>
    </ng-template>
  </ng-template>

</ng-container>
