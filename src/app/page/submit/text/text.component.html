<ng-container *mobxAutorun>
  <form class="form" [formGroup]="textForm" (ngSubmit)="submit()"
        [appLimitWidth]="fill?.nativeElement || (advancedForm?.fill | async)" [limitSibling]="true">

    <ng-container *ngIf="!advanced">
      <label for="title" *ngIf="!store.submit.wiki" i18n>Title:</label>
      <label for="title" *ngIf="store.submit.wiki" i18n>Wiki:</label>
      <input id="title"
             type="text"
             [formControl]="title"
             [appAutofocus]="!store.submit.wiki">
      <span><!-- Title Errors --></span>
      <div>
        <div class="error" *ngIf="title.touched && title.errors?.['required']" i18n>
          Title must not be blank.
        </div>
      </div>

      <div *ngIf="!store.submit.wiki" class="editor-label" i18n>
        <label for="comment">Comment:</label>
        <app-select-plugin #pluginSelect
                           class="shrink"
                           [text]="true"
                           i18n-title title="Add Plugin"
                           (pluginChange)="togglePlugin($event); pluginSelect.plugin = ''"></app-select-plugin>
      </div>
      <label *ngIf="store.submit.wiki" for="comment" class="editor-label" i18n>Entry:</label>
      <div #fill>
        <app-editor id="comment"
                    class="bubble"
                    [control]="comment"
                    (syncEditor)="syncEditor()"
                    (syncTags)="plugins = $event"
                    [fillWidth]="fill"
                    [autoFocus]="store.submit.wiki"></app-editor>
      </div>

      <span><!-- Viewer --></span>
      <div>
        <app-viewer [text]="textForm.value.comment"
                    [tags]="$any(textForm.value).tags"
                    (comment)="comment.setValue($event)"></app-viewer>
      </div>

      <app-tags [group]="textForm"></app-tags>

      <span><!-- Advanced --></span>
      <a class="fake-link no-select" (click)="advanced = true" i18n>show advanced</a>
    </ng-container>

    <ng-container *ngIf="advanced">
      <app-ref-form #advancedForm
                    [group]="textForm"
                    (editorTags)="plugins = $event"></app-ref-form>
    </ng-container>

    <ng-container *ngFor="let e of serverError">
      <span><!-- Unexpected Error --></span>
      <div class="error">{{ e }}</div>
    </ng-container>

    <span><!-- Buttons --></span>
    <span class="form-array right">
      <button type="submit" [disabled]="submitted && !textForm.valid" i18n>Submit</button>
    </span>
  </form>
</ng-container>
