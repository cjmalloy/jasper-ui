<ng-container *mobxAutorun>
  <div class="tabs">
    <h5>Submit</h5>
    <a routerLink="/submit" [class.current-tab]="store.submit.link" *ngIf="!store.submit.noPlugins.length" [queryParams]="{ tag: null, url: url.value }" [replaceUrl]="true">link</a>
    <a routerLink="/submit" [class.current-tab]="store.submit.link" *ngIf="store.submit.noPlugins.length" [queryParams]="{ tag: store.submit.noPlugins, url: url.value }" [replaceUrl]="true">{{ store.submit.noPlugins.join(', ') }}</a>
    <a routerLink="/submit/text" [queryParams]="{ tag: store.submit.noPlugins, url: null }">text</a>
    <a routerLink="/submit/dm" [queryParams]="{ tag: store.submit.noPlugins, url: null }">dm</a>
    <a routerLink="/submit" [class.current-tab]="store.submit.wiki" [queryParams]="{ tag: store.submit.noPlugins, url: 'wiki:' }" [replaceUrl]="true">wiki</a>
    <a routerLink="/submit" [class.current-tab]="store.submit.tags.includes(plugin.tag)" *ngFor="let plugin of store.submit.plugins" [queryParams]="{ tag: addPlugin(plugin.tag), url: url.value }" [replaceUrl]="true">{{ plugin.config?.submit || plugin.tag }}</a>
    <app-settings></app-settings>
  </div>
  <form class="form" [formGroup]="submitForm" (ngSubmit)="submit()">

    <ng-container *ngFor="let plugin of store.submit.activePlugins">
      <span>Type:</span>
      <div>
        <span>{{ plugin.name }}</span>
        <p *ngIf="plugin.config?.description" class="description">
          {{ plugin.config!.description }}
        </p>
      </div>
    </ng-container>

    <ng-container *ngIf="store.submit.wiki">
      <span>Type:</span>
      <div>
        <span>Wiki</span>
        <p class="description">
          Create a text post that can be linked to via double bracket [[Wiki]] style.
        </p>
      </div>
    </ng-container>

    <label for="url" class="big" *ngIf="!store.submit.wiki">URL:</label>
    <label for="url" class="big" *ngIf="store.submit.wiki">Title:</label>
    <input id="url"
           class="big"
           type="text"
           autocomplete="off"
           formControlName="url"
           appAutofocus>

    <span><!-- Tags --></span>
    <div class="form-array right">
      <span *ngFor="let tag of store.submit.tags">🏷️{{ tag }}</span>
    </div>

    <br>
    <div class="validations">
      <ng-container *ngFor="let v of validations">
        <div *ngIf="v.passed">✅️ &nbsp;{{ v.name }}</div>
        <div *ngIf="!v.passed">❌️ &nbsp;{{ v.name }}</div>
      </ng-container>
    </div>

    <span><!-- Buttons --></span>
    <span class="form-array right">
    <button type="submit" [disabled]="!submitForm.valid">Next</button>
    <div *ngIf="store.submit.link">
      <input id="scrape" type="checkbox" [checked]="scrape" (input)="scrape = $any($event.target).value">
      <label for="scrape">Scrape</label>
    </div>
  </span>
  </form>

  <ng-container *ngIf="existingRef">
    <br>
    <app-ref [ref]="existingRef" [showToggle]="true"></app-ref>
  </ng-container>

</ng-container>
