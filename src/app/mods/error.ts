import { DateTime } from 'luxon';
import { Plugin } from '../model/plugin';
import { Mod } from '../model/tag';

const errorPlugin: Plugin = {
  tag: '+plugin/error',
  name: $localize`‚ö†Ô∏è Error`,
  config: {
    mod: $localize`‚ö†Ô∏è Error`,
    default: true,
    generated: $localize`Generated by jasper-ui ${DateTime.now().toISO()}`,
    inbox: $localize`errors`,
    icons: [{ label: $localize`‚ö†Ô∏è` }],
    filters: [
      { query: '+plugin/error', label: $localize`‚ö†Ô∏è error`, title: $localize`Stopped with an error`, group: $localize`Plugins üß∞Ô∏è` },
    ],
    actions: [
      { tag: '+plugin/error', labelOn: $localize`retry` },
    ],
    description: $localize`
    View which Refs have failed running a script and will not be retried.
    See the attached logs for the specifics of the error.
    Click 'retry' to clear the error and try again.`,
  },
};

const logPlugin: Plugin = {
  tag: '+plugin/log',
  name: $localize`ü™µ Log`,
  config: {
    mod: $localize`‚ö†Ô∏è Error`,
    default: true,
    generated: $localize`Generated by jasper-ui ${DateTime.now().toISO()}`,
    icons: [{ label: $localize`ü™µ`, order: 3 }],
    filters: [
      { query: '+plugin/log', label: $localize`ü™µ logs`, title: $localize`Error logs`, group: $localize`Plugins üß∞Ô∏è` },
    ],
    description: $localize`Logs associated with a Ref.`,
    // language=CSS
    css: `
    .plugin_log .embed {
      white-space: pre;
      display: block;
      unicode-bidi: embed;
      font-family: monospace;
      .expand {
        max-width: min(100vw - 16px, 120em);
        overflow-x: auto;
      }
    }
    `
  },
};

export const errorMod: Mod = {
  plugin: [
    errorPlugin,
    logPlugin,
  ],
}
