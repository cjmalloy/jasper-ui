import { $localize } from '@angular/localize/init';
import moment from 'moment';
import { Mod } from '../model/tag';
import { Template } from '../model/template';

export const rootTemplate: Template = {
  tag: '',
  name: $localize`âš“ï¸ Root Template`,
  config: {
    mod: $localize`âš“ï¸ Root`,
    default: true,
    generated: 'Generated by jasper-ui ' + moment().toISOString(),
    description: $localize`Add common features Ext tag pages: Adding pinned Refs, sidebar markdown,
    a custom theme and a set of non-global custom themes to choose from in addition to global themes.`,
    // TODO: add model source code with vite text loader
    aiInstructions: ` # Root Template
    The root template uses the empty string as a tag. Since templates are matched to Exts by prefix matching,
    the root template matches every tag.
    The root template sets up basic functionality such as deleted icons and filters, and basic Ext config:
    \`\`\`typescript
    export interface RootConfig {
      pinned?: string[];
      sidebar?: string;
      modmail?: boolean;
      dms?: string;
      queryFilters?: { query: string, label?: string}[];
      responseFilters?: { response: \`plugin/\${string}\` | \`!plugin/\${string}\`, label?: string }[];
      themes?: Record<string, string>;
      theme?: string;
      defaultSort?: string;
      submitText?: boolean;
      addTags?: string[];
      defaultThumbnail?: boolean;
      defaultExpanded?: boolean;
      hideEdit?: boolean;
      disableResize?: boolean;
      defaultCols?: number;
    }
    \`\`\`
    `,
    icons: [
      { tag: 'plugin/delete', label: $localize`ğŸ—‘ï¸`, global: true },
      { tag: 'plugin/alt', label: $localize`â„¹ï¸`, global: true, order: -3 },
    ],
    form: [{
      key: 'pinned',
      type: 'urls',
      props: {
        label: $localize`Pinned:`,
        addText: $localize`+ Add another pinned link`,
      },
      fieldArray: {
        props: {
          label: $localize`ğŸ“Œï¸`,
        }
      },
    }, {
      key: 'submitText',
      type: 'select',
      defaultValue: false,
      props: {
        label: $localize`Submit:`,
        options: [
          { value: true, label: $localize`Text Posts` },
          { value: false, label: $localize`Link Posts` },
        ],
      }
    }, {
      key: 'addTags',
      type: 'tags',
      defaultValue: ['public'],
      props: {
        label: $localize`Add Tags:`
      },
    }, {
      key: 'queryFilters',
      type: 'list',
      props: {
        label: $localize`Query Filters:`,
        addText: $localize`+ Add another query filter`,
      },
      fieldArray: {
        fieldGroup: [{
          key: 'label',
          type: 'string',
          props: {
            label: $localize`Label:`
          }
        }, {
          key: 'query',
          type: 'query',
          props: {
            required: true,
          }
        }]
      }
    }],
    advancedForm: [{
      key: 'dms',
      type: 'tag',
      props: {
        label: $localize`DMs:`
      }
    }, {
      key: 'responseFilters',
      type: 'list',
      props: {
        label: $localize`Response Filters:`,
        addText: $localize`+ Add another response filter`,
      },
      fieldArray: {
        fieldGroup: [{
          key: 'label',
          type: 'string',
          props: {
            label: $localize`Label:`
          }
        }, {
          key: 'response',
          type: 'plugin',
          props: {
            required: true,
          }
        }]
      }
    }, {
      key: 'defaultThumbnail',
      type: 'url',
      props: {
        label: $localize`Default Thumbnail:`
      }
    }, {
      key: 'defaultCols',
      type: 'select',
      props: {
        label: $localize`Columns:`,
        options: [
          { label: $localize`Default` },
          { value: 1, label: $localize`1 Column` },
          { value: 2, label: $localize`2 Columns` },
          { value: 3, label: $localize`3 Columns` },
          { value: 4, label: $localize`4 Columns` },
          { value: 5, label: $localize`5 Columns` },
          { value: 6, label: $localize`6 Columns` },
        ],
      },
    }, {
      key: 'noFloatingSidebar',
      type: 'boolean',
      props: {
        label: $localize`No Floating Sidebar:`,
      },
    }],
  },
  defaults: <RootConfig> {
    defaultSort: 'published',
    addTags: ['public'],
  },
  schema: {
    optionalProperties: {
      pinned: { elements: { type: 'string' } },
      sidebar: { type: 'string' },
      modmail: { type: 'boolean' },
      dms: { type: 'string' },
      queryFilters: { elements: {
        properties: {
          query: { type: 'string' },
        },
        optionalProperties: {
          label: { type: 'string' },
        }
      }},
      responseFilters: { elements: {
        properties: {
          response: { type: 'string' },
        },
        optionalProperties: {
          label: { type: 'string' },
        }
      }},
      themes: { values: { type: 'string' } },
      theme: { type: 'string' },
      defaultSort: { type: 'string' },
      submitText: { type: 'boolean'},
      addTags: { elements: { type: 'string' } },
      defaultThumbnail: { type: 'string' },
      defaultExpanded: { type: 'boolean'},
      hideEdit: { type: 'boolean'},
      disableResize: { type: 'boolean'},
      defaultCols: { type: 'int8'},
      noFloatingSidebar: { type: 'boolean'},
    },
  },
};

export interface RootConfig {
  pinned?: string[];
  sidebar?: string;
  modmail?: boolean;
  dms?: string;
  queryFilters?: { query: string, label?: string}[];
  responseFilters?: { response: `plugin/${string}` | `!plugin/${string}`, label?: string }[];
  themes?: Record<string, string>;
  theme?: string;
  defaultSort?: string;
  submitText?: boolean;
  addTags?: string[];
  defaultThumbnail?: boolean;
  defaultExpanded?: boolean;
  hideEdit?: boolean;
  disableResize?: boolean;
  defaultCols?: number;
  noFloatingSidebar?: boolean;
}

export const lockedTemplate: Template = {
  tag: 'locked',
  name: $localize`ğŸ”’ï¸ Locked`,
  config: {
    mod: $localize`âš“ï¸ Root`,
    default: true,
    generated: $localize`Generated by jasper-ui ${moment().toISOString()}`,
    description: $localize`Show locked icon on locked Refs and add filters for
      locked and unlocked Refs`,
    icons: [
      { label: $localize`ğŸ”’ï¸`, title: $localize`Locked`, order: -2 },
    ],
    filters: [
      { query: 'locked', label: $localize`ğŸ”’ï¸ locked`, group: $localize`Filters ğŸ•µï¸ï¸` },
      { query: '!locked', label: $localize`ğŸ”“ï¸ unlocked`, group: $localize`Filters ğŸ•µï¸ï¸` },
    ],
    editorButtons: [
      { labelOff: $localize`ğŸ”“ï¸`, labelOn: $localize`ğŸ”’ï¸`, title: $localize`Lock this post to prevent editing`, ribbon: true, order: -1, global: true },
    ],
  },
};

export const privateTemplate: Template = {
  tag: 'public',
  name: $localize`ğŸŒï¸ Public`,
  config: {
    mod: $localize`âš“ï¸ Root`,
    default: true,
    generated: $localize`Generated by jasper-ui ${moment().toISOString()}`,
    description: $localize`Show private icon on non-public Refs and add filters for
      private and public Refs`,
    icons: [
      { label: $localize`ğŸ‘ï¸`, tag: '!public', title: $localize`Private`, order: -2, global: true },
    ],
    filters: [
      { query: 'public', label: $localize`ğŸŒï¸ public`, group: $localize`Filters ğŸ•µï¸ï¸` },
      { query: '!public', label: $localize`ğŸ‘ï¸ private`, group: $localize`Filters ğŸ•µï¸ï¸` },
    ],
    editorButtons: [
      { labelOff: $localize`ğŸ‘ï¸`, labelOn: $localize`ğŸŒï¸`, title: $localize`Toggle ğŸŒï¸ Public or ğŸ‘ï¸ Private`, remember: true, order: -1, global: true },
    ],
  },
};

export const rootMod: Mod = {
  templates: {
    rootTemplate,
    lockedTemplate,
    privateTemplate,
  }
}
